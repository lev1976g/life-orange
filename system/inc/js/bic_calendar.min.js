$.fn.bic_calendar=function(e){var t=$.extend({},$.fn.bic_calendar.defaults,e);return this.each(function(){function h(){a=$('<table class="diasmes table table">'),v();var t=new Date,s=f.val();if(""!=s&&y(s)){var r=s.split("/");2==r[2].length&&("0"==r[2].charAt(0)&&(r[2]=r[2].substring(1)),r[2]=parseInt(r[2]),r[2]<50&&(r[2]+=2e3)),t=new Date(r[2],r[1]-1,r[0])}var o=t.getMonth(),l=t.getFullYear();g(o,l);var d=$('<td><a href="#" class="botonmessiguiente"><i class="fa fa-arrow-right" ></i></a></td>');d.click(function(e){e.preventDefault(),o=(o+1)%12,0==o&&l++,u(o,l)});var p=$('<td><a href="#" class="botonmesanterior"><i class="fa fa-arrow-left" ></i></a></td>');p.click(function(e){e.preventDefault(),o-=1,-1==o&&(l--,o=11),u(o,l)});var c=$('<table class="table header"><tr></tr></table>'),h=$('<td colspan=5 class="mesyano span6"></td>');c.append(p),c.append(h),c.append(d),h.append(i),e=$('<div class="bic_calendar" id="'+n+'" ></div>'),e.prepend(c),e.append(a),f.append(e),C(o,l)}function u(e,t){a.empty(),v(),g(e,t),C(e,t)}function v(){if(0!=l){var e=$('<tr class="dias_semana" >'),t="";$(r).each(function(e,a){t+="<td",0==e&&(t+=' class="primero"'),6==e&&(t+=' class="domingo ultimo"'),t+=">"+a+"</td>"}),t+="</tr>",e.append(t),a.append(e)}}function g(e,t){i.text(o[e]+" "+t);for(var s=1,r=m(1,e,t),l=w(e,t),d=e+1,p="",c=0;7>c;c++){if(r>c){var f="";0==c&&(f+="<tr>"),f+='<td class="diainvalido',0==c&&(f+=" primero"),f+='"></td>'}else{var f="";0==c&&(f+="<tr>"),f+='<td id="'+n+"_"+s+"_"+d+"_"+t+'" ',0==c&&(f+=' class="primero"'),6==c&&(f+=' class="ultimo domingo"'),f+="><a>"+s+"</a></span>",6==c&&(f+="</tr>"),s++}p+=f}for(var h=1;l>=s;){var f="";h%7==1&&(f+="<tr>"),f+='<td id="'+n+"_"+s+"_"+d+"_"+t+'" ',h%7==1&&(f+=' class="primero"'),h%7==0&&(f+=' class="domingo ultimo"'),f+="><a>"+s+"</a></td>",h%7==0&&(f+="</tr>"),s++,h++,p+=f}if(h--,h%7!=0){f="";for(var c=h%7+1;7>=c;c++){var f="";f+='<td class="diainvalido',7==c&&(f+=" ultimo"),f+='"></td>',7==c&&(f+="</tr>"),p+=f}}a.append(p)}function m(e,t,a){var i=new Date(a,t,e),n=i.getDay();return 0==n?n=6:n--,n}function b(e,t,a){return e>0&&13>e&&a>0&&32768>a&&t>0&&t<=new Date(a,e,0).getDate()}function w(e,t){for(var a=28;b(e+1,a+1,t);)a++;return a}function y(e){var t=e.split("/");return 3!=t.length?!1:b(t[1],t[0],t[2])}function C(e,t){0!=c?$.ajax({type:c.type,url:c.url,data:{mes:e+1,ano:t},dataType:"json"}).done(function(a){s=[],$.each(a,function(e){s.push(a[e])}),_(e,t)}):_(e,t)}function _(e,t){for(var a=e+1,i=0;i<s.length;i++)s[i][0].split("/")[1]==a&&s[i][0].split("/")[2]==t&&($("#"+n+"_"+s[i][0].replace(/\//g,"_")).addClass("event"),$("#"+n+"_"+s[i][0].replace(/\//g,"_")+" a").attr("data-original-title",s[i][1]),s[i][3]&&$("#"+n+"_"+s[i][0].replace(/\//g,"_")).css("background",s[i][3]),""==s[i][2]||"#"==s[i][2]?""!=s[i][4]?($("#"+n+"_"+s[i][0].replace(/\//g,"_")+" a").attr("data-trigger","manual"),$("#"+n+"_"+s[i][0].replace(/\//g,"_")+" a").addClass("manual_popover")):$("#"+n+"_"+s[i][0].replace(/\//g,"_")+" a").attr("href","javascript:false;"):$("#"+n+"_"+s[i][0].replace(/\//g,"_")+" a").attr("href",s[i][2]),s[i][4]?($("#"+n+"_"+s[i][0].replace(/\//g,"_")).addClass("event_popover"),$("#"+n+"_"+s[i][0].replace(/\//g,"_")+" a").attr("rel","popover"),$("#"+n+"_"+s[i][0].replace(/\//g,"_")+" a").attr("data-content",s[i][4])):($("#"+n+"_"+s[i][0].replace(/\//g,"_")).addClass("event_tooltip"),$("#"+n+"_"+s[i][0].replace(/\//g,"_")+" a").attr("rel","tooltip")));$("#"+n+" .event_tooltip a").tooltip(p),$("#"+n+" .event_popover a").popover(d),$(".manual_popover").click(function(){$(this).popover("toggle")})}var e,a,r,i=$('<div class="visualmesano"></div>'),n="bic_cal_"+Math.floor(99999*Math.random()).toString(36),s=t.events;r="undefined"!=typeof t.dias?t.dias:["l","m","x","j","v","s","d"];var o;o="undefined"!=typeof t.nombresMes?t.nombresMes:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];var l;l="undefined"!=typeof t.show_days?t.show_days:!0;var d;d="undefined"!=typeof t.popover_options?t.popover_options:{placement:"top"};var p;p="undefined"!=typeof t.tooltip_options?t.tooltip_options:{placement:"top"};var c;c="undefined"!=typeof t.req_ajax?t.req_ajax:!1;var f=$(this);h()}),this},mesos=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],dias=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],$("#bic_calendar_right").bic_calendar({nombresMes:mesos,dias:dias,req_ajax:{type:"get",url:"index.html"}});